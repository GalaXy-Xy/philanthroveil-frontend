"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[800],{557:(e,t,r)=>{r.d(t,{S:()=>c,z:()=>u});var n=r(5155),a=r(1012),i=r(6037),o=r(3139),s=r(2115);let l=(0,s.createContext)(void 0),c=e=>{let{children:t,initialMockChains:r}=e,c=function(e){let{initialMockChains:t}=e,{provider:r,chainId:n,accounts:l,isConnected:c,connect:u,error:d}=(0,o.h)(),[h,y]=(0,s.useState)(void 0),[f,p]=(0,s.useState)(void 0),[w,v]=(0,s.useState)(void 0),g=(0,s.useRef)(n),m=(0,s.useRef)(void 0),b=(0,s.useRef)(e=>e===g.current),S=(0,s.useRef)(e=>e===m.current);return(0,s.useEffect)(()=>{g.current=n},[n]),(0,s.useEffect)(()=>{if(!r||!n||!c||!l||0===l.length){m.current=void 0,y(void 0),p(void 0),v(void 0);return}console.warn("[useMetaMaskEthersSignerInternal] create new ethers.BrowserProvider(), chainId=".concat(n));let e=new a.k(r),o=e,s=null==t?void 0:t[n];s?(o=new i.FR(s),console.warn("[useMetaMaskEthersSignerInternal] create new readonly provider ethers.JsonRpcProvider(".concat(s,"), chainId=").concat(n))):console.warn("[useMetaMaskEthersSignerInternal] use ethers.BrowserProvider() as readonly provider, chainId=".concat(n));let u=new i.cP(e,l[0]);m.current=u,y(u),p(e),v(o)},[r,n,c,l,t]),{sameChain:b,sameSigner:S,provider:r,chainId:n,accounts:l,isConnected:c,connect:u,ethersBrowserProvider:f,ethersReadonlyProvider:w,ethersSigner:h,error:d,initialMockChains:t}}({initialMockChains:r});return(0,n.jsx)(l.Provider,{value:c,children:t})};function u(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useMetaMaskEthersSigner must be used within a MetaMaskEthersSignerProvider");return e}},2800:(e,t,r)=>{let n;r.d(t,{l:()=>ei,L:()=>eo});var a=r(5155),i=r(2115),o=r(3139),s=r(557),l=r(4827),c=r(6037);let u="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs";class d{isLoaded(){return y(window,this._trace)}load(){if(console.log("[RelayerSDKLoader] load..."),"relayerSDK"in window){if(!h(window.relayerSDK,this._trace))throw console.log("[RelayerSDKLoader] window.relayerSDK === undefined"),Error("RelayerSDKLoader: Unable to load FHEVM Relayer SDK");return Promise.resolve()}return new Promise((e,t)=>{if(document.querySelector('script[src="'.concat(u,'"]'))){y(window,this._trace)||t(Error("RelayerSDKLoader: window object does not contain a valid relayerSDK object.")),e();return}let r=document.createElement("script");r.src=u,r.type="text/javascript",r.async=!0,r.onload=()=>{y(window,this._trace)||(console.log("[RelayerSDKLoader] script onload FAILED..."),t(Error("RelayerSDKLoader: Relayer SDK script has been successfully loaded from ".concat(u,", however, the window.relayerSDK object is invalid.")))),e()},r.onerror=()=>{console.log("[RelayerSDKLoader] script onerror... "),t(Error("RelayerSDKLoader: Failed to load Relayer SDK from ".concat(u)))},console.log("[RelayerSDKLoader] add script to DOM..."),document.head.appendChild(r),console.log("[RelayerSDKLoader] script added!")})}constructor(e){this._trace=e.trace}}function h(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: relayerSDK is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: relayerSDK is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: relayerSDK is not an object"),!1):f(e,"initSDK","function",t)?f(e,"createInstance","function",t)?f(e,"SepoliaConfig","object",t)?!("__initialized__"in e)||!0===e.__initialized__||!1===e.__initialized__||(null==t||t("RelayerSDKLoader: relayerSDK.__initialized__ is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.createInstance is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.initSDK is invalid"),!1)}function y(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: window object is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: window object is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: window is not an object"),!1):"relayerSDK"in e?h(e.relayerSDK):(null==t||t("RelayerSDKLoader: window does not contain 'relayerSDK' property"),!1)}function f(e,t,r,n){if(!e||"object"!=typeof e)return!1;if(!(t in e))return null==n||n("RelayerSDKLoader: missing ".concat(String(t),".")),!1;let a=e[t];return null==a?(null==n||n("RelayerSDKLoader: ".concat(String(t)," is null or undefined.")),!1):typeof a===r||(null==n||n("RelayerSDKLoader: ".concat(String(t)," is not a ").concat(r,".")),!1)}var p=r(3899);async function w(){return n||(n=(0,p.P2)("fhevm",1,{upgrade(e){e.objectStoreNames.contains("paramsStore")||e.createObjectStore("paramsStore",{keyPath:"acl"}),e.objectStoreNames.contains("publicKeyStore")||e.createObjectStore("publicKeyStore",{keyPath:"acl"})}}))}function v(e){if("object"!=typeof e)throw Error("FhevmStoredPublicKey must be an object");if(null!==e){if(!("publicKeyId"in e))throw Error("FhevmStoredPublicKey.publicKeyId does not exist");if("string"!=typeof e.publicKeyId)throw Error("FhevmStoredPublicKey.publicKeyId must be a string");if(!("publicKey"in e))throw Error("FhevmStoredPublicKey.publicKey does not exist");if(!(e.publicKey instanceof Uint8Array))throw Error("FhevmStoredPublicKey.publicKey must be a Uint8Array")}}function g(e){if("object"!=typeof e)throw Error("FhevmStoredPublicParams must be an object");if(null!==e){if(!("publicParamsId"in e))throw Error("FhevmStoredPublicParams.publicParamsId does not exist");if("string"!=typeof e.publicParamsId)throw Error("FhevmStoredPublicParams.publicParamsId must be a string");if(!("publicParams"in e))throw Error("FhevmStoredPublicParams.publicParams does not exist");if(!(e.publicParams instanceof Uint8Array))throw Error("FhevmStoredPublicParams.publicParams must be a Uint8Array")}}async function m(e){let t,r=await w();if(!r)return{publicParams:null};let n=null;try{let t=await r.get("publicKeyStore",e);(null==t?void 0:t.value)&&(v(t.value),n=t.value)}catch(e){}let a=null;try{let t=await r.get("paramsStore",e);(null==t?void 0:t.value)&&(g(t.value),a=t.value)}catch(e){}let i=null==n?void 0:n.publicKey,o=null==n?void 0:n.publicKeyId,s=a?{2048:a}:null;return o&&i&&(t={id:o,data:i}),{...void 0!==t&&{publicKey:t},publicParams:s}}async function b(e,t,r){v(t),g(r);let n=await w();n&&(t&&await n.put("publicKeyStore",{acl:e,value:t}),r&&await n.put("paramsStore",{acl:e,value:r}))}class S extends Error{constructor(e,t,r){super(t,r),this.code=e,this.name="FhevmReactError"}}function _(e,t,r){throw new S(e,t,r?{cause:r}:void 0)}let K=async e=>{if(!y(window,console.log))throw Error("window.relayerSDK is not available");let t=await window.relayerSDK.initSDK(e);if(window.relayerSDK.__initialized__=t,!t)throw Error("window.relayerSDK.initSDK failed.");return!0};class D extends Error{constructor(e="FHEVM operation was cancelled"){super(e),this.name="FhevmAbortError"}}async function E(e){if("string"==typeof e){let t=new c.FR(e);return Number((await t.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function R(e){let t=new c.FR(e);try{return await t.send("web3_clientVersion",[])}catch(t){_("WEB3_CLIENTVERSION_ERROR","The URL ".concat(e," is not a Web3 node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function k(e){let t=await R(e);if("string"==typeof t&&t.toLowerCase().includes("hardhat"))try{let t=await P(e);if(!t||"object"!=typeof t||!("ACLAddress"in t&&"string"==typeof t.ACLAddress&&t.ACLAddress.startsWith("0x"))||!("InputVerifierAddress"in t&&"string"==typeof t.InputVerifierAddress&&t.InputVerifierAddress.startsWith("0x"))||!("KMSVerifierAddress"in t&&"string"==typeof t.KMSVerifierAddress&&t.KMSVerifierAddress.startsWith("0x")))return;return t}catch(e){return}}async function P(e){let t=new c.FR(e);try{return await t.send("fhevm_relayer_metadata",[])}catch(t){_("FHEVM_RELAYER_METADATA_ERROR","The URL ".concat(e," is not a FHEVM Hardhat node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function I(e,t){let r=await E(e),n="string"==typeof e?e:void 0,a={31337:"http://localhost:8545",...null!=t?t:{}};return Object.hasOwn(a,r)?(n||(n=a[r]),{isMock:!0,chainId:r,rpcUrl:n}):{isMock:!1,chainId:r,rpcUrl:n}}let M=async e=>{let t=()=>{if(a.aborted)throw new D},n=e=>{i&&i(e)},{signal:a,onStatusChange:i,provider:o,mockChains:s}=e,{isMock:c,rpcUrl:u,chainId:h}=await I(o,s);if(c){let e=await k(u);if(e){n("creating");let a=await Promise.all([r.e(235),r.e(514)]).then(r.bind(r,5514)),i=await a.fhevmMockCreateInstance({rpcUrl:u,chainId:h,metadata:e});return t(),i}}t(),y(window,console.log)||(n("sdk-loading"),await new d({trace:console.log}).load(),t(),n("sdk-loaded")),y(window,console.log)&&!0===window.relayerSDK.__initialized__||(n("sdk-initializing"),await K(),t(),n("sdk-initialized"));let f=window.relayerSDK,p=f.SepoliaConfig.aclContractAddress;if(!function(e){return"string"==typeof e&&!!(0,l.PW)(e)}(p))throw Error("Invalid address: ".concat(p));let w=await m(p);t();let v={...f.SepoliaConfig,network:o,publicKey:w.publicKey,publicParams:w.publicParams};n("creating");let g=await f.createInstance(v);return await b(p,g.getPublicKey(),g.getPublicParams(2048)),t(),g};function A(e,t){if(!e){let e=t?"Assertion failed: ".concat(t):"Assertion failed.";throw console.error(e),Error(e)}}var L=r(2127),C=r(3338),j=r(9794),F=r(7325),N=r(5777),W=r(5378),x=r(2507);function T(){return Math.floor(Date.now()/1e3)}var V=new WeakMap,O=new WeakMap,q=new WeakMap,z=new WeakMap;class U{get contractAddresses(){return(0,F._)(this,V)}get userAddress(){return(0,F._)(this,O)}get publicKey(){return(0,F._)(this,q)}get key(){return(0,F._)(this,z)}constructor(e,t,r,n){if((0,N._)(this,V,{writable:!0,value:void 0}),(0,N._)(this,O,{writable:!0,value:void 0}),(0,N._)(this,q,{writable:!0,value:void 0}),(0,N._)(this,z,{writable:!0,value:void 0}),!l.PW(r))throw TypeError("Invalid address ".concat(r));let a=t.sort(),i=e.createEIP712(null!=n?n:L.j,a,0,0);try{let e=x.z.hash(i.domain,{UserDecryptRequestVerification:i.types.UserDecryptRequestVerification},i.message);(0,W._)(this,V,a),(0,W._)(this,O,r),(0,W._)(this,z,"".concat(r,":").concat(e))}catch(e){throw console.log(e),e}}}var B=new WeakMap,G=new WeakMap,J=new WeakMap,H=new WeakMap,Z=new WeakMap,Y=new WeakMap,Q=new WeakMap,X=new WeakMap;class ${get privateKey(){return(0,F._)(this,G)}get publicKey(){return(0,F._)(this,B)}get signature(){return(0,F._)(this,J)}get contractAddresses(){return(0,F._)(this,Q)}get startTimestamp(){return(0,F._)(this,H)}get durationDays(){return(0,F._)(this,Z)}get userAddress(){return(0,F._)(this,Y)}static checkIs(e){if(!e||"object"!=typeof e||!("publicKey"in e&&"string"==typeof e.publicKey)||!("privateKey"in e&&"string"==typeof e.privateKey)||!("signature"in e&&"string"==typeof e.signature)||!("startTimestamp"in e&&"number"==typeof e.startTimestamp)||!("durationDays"in e&&"number"==typeof e.durationDays)||!("contractAddresses"in e&&Array.isArray(e.contractAddresses)))return!1;for(let t=0;t<e.contractAddresses.length;++t)if("string"!=typeof e.contractAddresses[t]||!e.contractAddresses[t].startsWith("0x"))return!1;return!!("userAddress"in e&&"string"==typeof e.userAddress&&e.userAddress.startsWith("0x"))&&!!("eip712"in e&&"object"==typeof e.eip712&&null!==e.eip712)&&!!("domain"in e.eip712&&"object"==typeof e.eip712.domain)&&!!("primaryType"in e.eip712&&"string"==typeof e.eip712.primaryType)&&"message"in e.eip712&&!!("types"in e.eip712&&"object"==typeof e.eip712.types&&null!==e.eip712.types)}toJSON(){return{publicKey:(0,F._)(this,B),privateKey:(0,F._)(this,G),signature:(0,F._)(this,J),startTimestamp:(0,F._)(this,H),durationDays:(0,F._)(this,Z),userAddress:(0,F._)(this,Y),contractAddresses:(0,F._)(this,Q),eip712:(0,F._)(this,X)}}static fromJSON(e){return new $("string"==typeof e?JSON.parse(e):e)}equals(e){return e.signature===(0,F._)(this,J)}isValid(){return T()<(0,F._)(this,H)+24*(0,F._)(this,Z)*3600}async saveToGenericStringStorage(e,t,r){try{let n=JSON.stringify(this),a=new U(t,(0,F._)(this,Q),(0,F._)(this,Y),r?(0,F._)(this,B):void 0);await e.setItem(a.key,n),console.log("signature saved! contracts=".concat((0,F._)(this,Q).length))}catch(e){console.error("FhevmDecryptionSignature.saveToGenericStringStorage() failed!")}}static async loadFromGenericStringStorage(e,t,r,n,a){try{let i=new U(t,r,n,a),o=await e.getItem(i.key);if(!o)return console.warn("Could not load signature! key=".concat(i.key)),null;try{let e=$.fromJSON(o);if(!e.isValid())return null;return e}catch(e){return null}}catch(e){return console.error("FhevmDecryptionSignature.loadFromGenericStringStorage() failed!"),null}}static async new(e,t,r,n,a){try{let i=await a.getAddress(),o=T(),s=e.createEIP712(r,t,o,365),l=await a.signTypedData(s.domain,{UserDecryptRequestVerification:s.types.UserDecryptRequestVerification},s.message);return new $({publicKey:r,privateKey:n,contractAddresses:t,startTimestamp:o,durationDays:365,signature:l,eip712:s,userAddress:i})}catch(e){return null}}static async loadOrSign(e,t,r,n,a){let i=await r.getAddress(),o=await $.loadFromGenericStringStorage(n,e,t,i,null==a?void 0:a.publicKey);if(o)return o;let{publicKey:s,privateKey:l}=null!=a?a:e.generateKeypair(),c=await $.new(e,t,s,l,r);return c?(await c.saveToGenericStringStorage(n,e,!!(null==a?void 0:a.publicKey)),c):null}constructor(e){if((0,N._)(this,B,{writable:!0,value:void 0}),(0,N._)(this,G,{writable:!0,value:void 0}),(0,N._)(this,J,{writable:!0,value:void 0}),(0,N._)(this,H,{writable:!0,value:void 0}),(0,N._)(this,Z,{writable:!0,value:void 0}),(0,N._)(this,Y,{writable:!0,value:void 0}),(0,N._)(this,Q,{writable:!0,value:void 0}),(0,N._)(this,X,{writable:!0,value:void 0}),!$.checkIs(e))throw TypeError("Invalid FhevmDecryptionSignatureType");(0,W._)(this,B,e.publicKey),(0,W._)(this,G,e.privateKey),(0,W._)(this,J,e.signature),(0,W._)(this,H,e.startTimestamp),(0,W._)(this,Z,e.durationDays),(0,W._)(this,Y,e.userAddress),(0,W._)(this,Q,e.contractAddresses),(0,W._)(this,X,e.eip712)}}let ee={abi:[]},et={31337:{address:"0x0000000000000000000000000000000000000000",chainId:31337,chainName:"localhost"},0xaa36a7:{address:"0x0000000000000000000000000000000000000000",chainId:0xaa36a7,chainName:"sepolia"}};class er{async getItem(e){var t;return null!=(t=this.storage.get(e))?t:null}async setItem(e,t){this.storage.set(e,t)}async removeItem(e){this.storage.delete(e)}constructor(){this.storage=new Map}}let en=new er,ea=(0,i.createContext)(void 0);function ei(e){let{children:t}=e,{provider:r,chainId:n}=(0,o.h)(),{ethersSigner:l,ethersReadonlyProvider:c}=(0,s.z)(),{instance:u}=function(e){let{provider:t,chainId:r,initialMockChains:n,enabled:a=!0}=e,[o,s]=(0,i.useState)(void 0),[l,c]=(0,i.useState)("idle"),[u,d]=(0,i.useState)(void 0),[h,y]=(0,i.useState)(a),[f,p]=(0,i.useState)(0),w=(0,i.useRef)(null),v=(0,i.useRef)(t),g=(0,i.useRef)(r),m=(0,i.useRef)(n),b=(0,i.useCallback)(()=>{w.current&&(v.current=void 0,g.current=void 0,w.current.abort(),w.current=null),v.current=t,g.current=r,s(void 0),d(void 0),c("idle"),void 0!==t&&p(e=>e+1)},[t,r]);return(0,i.useEffect)(()=>{b()},[b]),(0,i.useEffect)(()=>{y(a)},[a]),(0,i.useEffect)(()=>{if(!1===h){console.log("cancelled"),w.current&&(w.current.abort(),w.current=null),s(void 0),d(void 0),c("idle");return}if(!0===h){if(void 0===v.current){s(void 0),d(void 0),c("idle");return}w.current||(w.current=new AbortController),A(!w.current.signal.aborted,"!controllerRef.current.signal.aborted"),c("loading"),d(void 0);let e=w.current.signal,t=v.current;M({signal:e,provider:t,mockChains:m.current,onStatusChange:e=>console.log("[useFhevm] createFhevmInstance status changed: ".concat(e))}).then(r=>{console.log("[useFhevm] createFhevmInstance created!"),e.aborted||(A(t===v.current,"thisProvider === _providerRef.current"),s(r),d(void 0),c("ready"))}).catch(r=>{console.log("Error Was thrown !!! error... "+r.name),e.aborted||(A(t===v.current,"thisProvider === _providerRef.current"),s(void 0),d(r),c("error"))})}},[h,f]),{instance:o,refresh:b,error:u,status:l}}({provider:r,chainId:n}),d=(e=>{let{instance:t,fhevmDecryptionSignatureStorage:r,chainId:n,ethersSigner:a,ethersReadonlyProvider:o}=e,[s,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)(""),d=(0,i.useMemo)(()=>{if(!n)return;let e=et[n.toString()];if(e&&"address"in e&&e.address!==L.j)return e.address},[n]),h=(0,i.useMemo)(()=>d&&o?new C.NZ(d,ee.abi,o):null,[d,o]),y=(0,i.useMemo)(()=>d&&a?new C.NZ(d,ee.abi,a):null,[d,a]),f=(0,i.useCallback)(async(e,t,r,n)=>{if(!y||!h)throw Error("No signer");l(!0),u("Creating project...");try{let a=await y.createProject(e,t,r,n);u("Waiting for confirmation..."),await a.wait();let i=await h.projectCount(),o=Number(i)-1;return u("Project created successfully!"),o}catch(e){throw u("Failed to create project: "+e.message),e}finally{l(!1)}},[y,h]),p=(0,i.useCallback)(async(e,r)=>{if(!y||!t||!a)throw Error("Not ready");l(!0),u("Encrypting donation...");try{let n=j.g5(r),i=t.createEncryptedInput(d,await a.getAddress());i.add64(BigInt(n.toString()));let o=await i.encrypt();u("Submitting donation...");let s=await y.donate(e,o.handles[0],o.inputProof,{value:n});return u("Waiting for confirmation..."),await s.wait(),u("Donation successful!"),!0}catch(e){throw u("Donation failed: "+e.message),e}finally{l(!1)}},[y,t,a,d]),w=(0,i.useCallback)(async e=>{if(!y||!t||!a||!d)throw Error("Not ready");l(!0),u("Requesting authorization...");try{let n=await y.getTotalDonations(e);await n.wait(),u("Fetching encrypted data...");let i=await y.getTotalDonations.staticCall(e);u("Requesting decryption signature...");let o=await $.loadOrSign(t,[d],a,r);if(!o)throw Error("Failed to get decryption signature");u("Decrypting...");let s=(await t.userDecrypt([{handle:i,contractAddress:d}],o.privateKey,o.publicKey,o.signature,o.contractAddresses,o.userAddress,o.startTimestamp,o.durationDays))[i];u("Decryption successful!");let l="bigint"==typeof s?s:BigInt(s.toString());return j.ck(l)}catch(e){throw u("Decryption failed: "+e.message),e}finally{l(!1)}},[y,t,a,d,r]),v=(0,i.useCallback)(async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!y||!t||!a||!d)throw Error("Not ready");l(!0),u("Requesting authorization...");try{let i=await y.getLeaderboard(e,n);await i.wait(),u("Fetching leaderboard...");let o=await y.getLeaderboard.staticCall(e,n),s=o[0],l=o[1];if(0===s.length)return u("No donations yet"),[];u("Requesting decryption signature...");let c=await $.loadOrSign(t,[d],a,r);if(!c)throw Error("Failed to get decryption signature");u("Decrypting leaderboard...");let h=s.map(e=>({handle:e,contractAddress:d})),f=await t.userDecrypt(h,c.privateKey,c.publicKey,c.signature,c.contractAddresses,c.userAddress,c.startTimestamp,c.durationDays);u("Aggregating by donor...");let p=new Map;for(let e=0;e<s.length;e++){let t=s[e],r=l[e].toLowerCase(),n=f[t],a="bigint"==typeof n?n:BigInt(n.toString());p.has(r)?p.set(r,p.get(r)+a):p.set(r,a)}let w=Array.from(p.entries()).map(e=>{let[t,r]=e;return{donor:t,amount:j.ck(r),amountWei:r.toString(),rank:0}});return w.sort((e,t)=>BigInt(t.amountWei)>BigInt(e.amountWei)?1:-1),w.forEach((e,t)=>{e.rank=t+1}),u("Leaderboard decrypted!"),w}catch(e){throw u("Failed to load leaderboard: "+e.message),e}finally{l(!1)}},[y,t,a,d,r]);return{contractAddress:d,contract:h,writeContract:y,createProject:f,donate:p,decryptTotalDonations:w,getLeaderboard:v,isLoading:s,message:c}})({instance:u,fhevmDecryptionSignatureStorage:en,chainId:n,ethersSigner:l,ethersReadonlyProvider:c});return(0,a.jsx)(ea.Provider,{value:d,children:t})}function eo(){let e=(0,i.useContext)(ea);if(!e)throw Error("usePhilanthroVeil must be used within PhilanthroVeilProvider");return e}},3139:(e,t,r)=>{r.d(t,{r:()=>o,h:()=>s});var n=r(5155),a=r(2115);let i=(0,a.createContext)(void 0),o=e=>{let{children:t}=e,{provider:r,chainId:o,accounts:s,isConnected:l,error:c,connect:u}=function(){var e;let{error:t,providers:r}=function(){let[e,t]=(0,a.useState)(void 0),[r,n]=(0,a.useState)(void 0),i=(0,a.useRef)(0),o=(0,a.useRef)(!1),s=(0,a.useMemo)(()=>r?Object.values(r):[],[r]);return(0,a.useEffect)(()=>{let e=++i.current,r=e=>{if("detail"in e){var t;t=e.detail,n(e=>{if(!e)return{[t.info.uuid]:t};let r=e[t.info.uuid];return r&&r.info.uuid===t.info.uuid&&r.info.name===t.info.name&&r.info.rdns===t.info.rdns&&r.info.icon===t.info.icon&&r.provider===t.provider?e:(r?console.log("addUuid(".concat(t.info.uuid,") update existing.")):console.log("addUuid(".concat(t.info.uuid,") add new.")),{...e,[t.info.uuid]:t})})}};return(async()=>{if(e===i.current){if(o.current)return console.log("window is already listening!!!");t(void 0);try{window.addEventListener("eip6963:announceProvider",r)}catch(e){t(e instanceof Error?e:Error(String(e)));return}o.current=!0;try{window.dispatchEvent(new Event("eip6963:requestProvider"))}catch(e){window.removeEventListener("eip6963:announceProvider",r),t(e instanceof Error?e:Error(String(e))),o.current=!1}}})(),()=>{i.current=i.current+1,window.removeEventListener("eip6963:announceProvider",r)}},[]),{error:e,uuids:r,providers:s}}(),[n,i]=(0,a.useState)(void 0),[o,s]=(0,a.useState)(void 0),[l,c]=(0,a.useState)(void 0),u=(0,a.useRef)(void 0),d=(0,a.useRef)(void 0),h=(0,a.useRef)(void 0),y=(0,a.useRef)(void 0),f=(0,a.useRef)(void 0),p=!!n,w=(null!=(e=null==l?void 0:l.length)?e:0)>0,v=(0,a.useCallback)(()=>{n&&(l&&l.length>0||n.request({method:"eth_requestAccounts"}))},[n,l]);return(0,a.useEffect)(()=>{var e,t,n,a,o,l,p,w,v,g,m,b,S;let _,K,D,E,R;for(let e=0;e<r.length;++e)if("metamask"===r[e].info.name.toLowerCase()){_=r[e].provider;break}let k=f.current;k!==_&&(k&&(u.current&&(null==(e=k.off)||e.call(k,"connect",u.current),null==(t=k.removeListener)||t.call(k,"connect",u.current),u.current=void 0),d.current&&(null==(n=k.off)||n.call(k,"disconnect",d.current),null==(a=k.removeListener)||a.call(k,"disconnect",d.current),d.current=void 0),h.current&&(null==(o=k.off)||o.call(k,"chainChanged",h.current),null==(l=k.removeListener)||l.call(k,"chainChanged",h.current),h.current=void 0),y.current&&(null==(p=k.off)||p.call(k,"accountsChanged",y.current),null==(w=k.removeListener)||w.call(k,"accountsChanged",y.current),y.current=void 0)),i(void 0),s(void 0),c(void 0),f.current=_,u.current=void 0,d.current=void 0,h.current=void 0,y.current=void 0,_&&(u.current=K=e=>{_===f.current&&(console.log("[useMetaMask] on('connect') chainId=".concat(e.chainId)),i(_),s(Number.parseInt(e.chainId,16)))},d.current=D=e=>{_===f.current&&(console.log("[useMetaMask] on('disconnect') error code=".concat(e.code)),i(void 0),s(void 0),c(void 0))},h.current=E=e=>{_===f.current&&(console.log("[useMetaMask] on('chainChanged') chainId=".concat(e)),i(_),s(Number.parseInt(e,16)))},y.current=R=e=>{_===f.current&&(console.log("[useMetaMask] on('accountsChanged') accounts.length=".concat(e.length)),i(_),c(e))},_.on?(_.on("connect",K),_.on("disconnect",D),_.on("chainChanged",E),null==(v=_.on)||v.call(_,"accountsChanged",R)):(null==(g=_.addListener)||g.call(_,"connect",K),null==(m=_.addListener)||m.call(_,"disconnect",D),null==(b=_.addListener)||b.call(_,"chainChanged",E),null==(S=_.addListener)||S.call(_,"accountsChanged",R)),(async()=>{if(_===f.current)try{let[e,t]=await Promise.all([_.request({method:"eth_chainId"}),_.request({method:"eth_accounts"})]);console.log("[useMetaMask] connected to chainId=".concat(e," accounts.length=").concat(t.length)),i(_),s(Number.parseInt(e,16)),c(t)}catch(e){console.log("[useMetaMask] not connected!"),i(_),s(void 0),c(void 0)}})()))},[r]),(0,a.useEffect)(()=>()=>{let e=f.current;if(e){var t,r,n,a,i,o,s,l;let c=h.current,f=y.current,p=u.current,w=d.current;p&&(null==(t=e.off)||t.call(e,"connect",p),null==(r=e.removeListener)||r.call(e,"connect",p)),w&&(null==(n=e.off)||n.call(e,"disconnect",w),null==(a=e.removeListener)||a.call(e,"disconnect",w)),c&&(null==(i=e.off)||i.call(e,"chainChanged",c),null==(o=e.removeListener)||o.call(e,"chainChanged",c)),f&&(null==(s=e.off)||s.call(e,"accountsChanged",f),null==(l=e.removeListener)||l.call(e,"accountsChanged",f))}h.current=void 0,f.current=void 0},[]),{provider:n,chainId:o,accounts:l,isConnected:p&&w&&"number"==typeof o,error:t,connect:v}}();return(0,n.jsx)(i.Provider,{value:{provider:r,chainId:o,accounts:s,isConnected:l,error:c,connect:u},children:t})};function s(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useMetaMask must be used within a MetaMaskProvider");return e}}}]);